<!DOCTYPE html>
<html>
  <head>
    <title>CrimeLoc</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="stylesheets/css/foundation.css">
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="semantic/dist/semantic.min.css">
    <script src="semantic/dist/semantic.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="jquery.timepicker.min.js"></script>
    <link rel="stylesheet" href="jquery.timepicker.css">
  </head>

  <body>

    <div class="ui multiple selection dropdown" style="visibility: hidden">
      <!-- This will receive comma separated value like OH,TX,WY !-->
      <input id="buildings" name="buildings" type="hidden">
      <i class="dropdown icon"></i>
      <div class="default text">Building</div>
      <div class="menu">
        <div data-value="Academic">Academic</div>
        <div data-value="Administrative">Administrative</div>
        <div data-value="Athletic">Athletic</div>
        <div data-value="Dining">Dining</div>
        <div data-value="Residence">Residence</div>
        <div data-value="Library">Library</div>
        <div data-value="Medical">Medical</div>
        <div data-value="Parking">Parking</div>
        <div data-value="Transportation">Transportation</div>
      </div>

      <input id="crimes" name="crimes" type="hidden">
      <i class="dropdown icon"></i>
      <div class="default text">Crimes</div>
      <div class="menu">
        <div data-value="Fraud">Fraud</div>
        <div data-value="Larceny">Larceny</div>
        <div data-value="Breaking and Entering">Breaking and Entering</div>
        <div data-value="Resist, Delay, Obstruct">Resist, Delay, Obstruct</div>
        <div data-value="Alcohol">Alcohol</div>
        <div data-value="Underage">Underage</div>
        <div data-value="Injury">Injury</div>
        <div data-value="Trespass">Trespass</div>
        <div data-value="Weapon">Weapon</div>
        <div data-value="Possession">Possession</div>
        <div data-value="Assault">Assault</div>
        <div data-value="Forgery and Uttering">Forgery and Uttering</div>
        <div data-value="Theft">Theft</div>
        <div data-value="Burglary">Burglary</div>
        <div data-value="Robbery">Robbery</div>
        <div data-value="Stalking">Stalking</div>
        <div data-value="Drug">Drug</div>
        <div data-value="Other">Other</div>
      </div>
    </div>



    <div class="row" align = "center">
      <h1>Welcome to CrimeLoc!</h1>
    </div>
    <div class="row" align="center">
      <div class="large-12 columns">
      <label>Search Parameters (specify as many or as few as desired)
      </label>
      </div>

      <div class="large-6 columns">
        <select name="buildings" class="ui selection dropdown" multiple="" id="multi-select">
          <option value="">Building Types</option>
          <option value="Academic">Academic</option>
          <option value="Administrative">Administrative</option>
          <option value="Athletic">Athletic</option>
          <option value="Dining">Dining</option>
          <option value="Residence">Residence</option>
          <option value="Library">Library</option>
          <option value="Medical">Medical</option>
          <option value="Parking">Parking</option>
          <option value="Transportation">Transportation</option>
        </select>

      </div>
      <div class="large-6 columns">
         <select name="crimes" class="ui selection dropdown" multiple="" id="multi-select2">
          <option value="">Crime Types</option>
         <!-- TODO: FIX THIS !-->
         <option value="Fraud">Fraud</option>
         <option value="Larceny">Larceny</option>
         <option value="Breaking and Entering">Breaking and Entering</option>
         <option value="Resist, Delay, Obstruct">Resist, Delay, Obstruct</option>
         <option value="Alcohol">Alcohol</option>
         <option value="Underage">Underage</option>
         <option value="Injury">Injury</option>
         <option value="Trespass">Trespass</option>
         <option value="Weapon">Weapon</option>
         <option value="Possession">Possession</option>
         <option value="Assault">Assault</option>
         <option value="Forgery and Uttering">Forgery and Uttering</option>
         <option value="Theft">Theft</option>
         <option value="Burglary">Burglary</option>
         <option value="Robbery">Robbery</option>
         <option value="Stalking">Stalking</option>
         <option value="Drug">Drug</option>
         <option value="Other">Other</div>
        </select>
      </div>
      <div class="large-2 columns">
        <label> Date
          <input id="datepicker" type="text"></input>
        </label>
      </div>
      <div class="large-4 columns">
        <label> Time
          <br>
          <label>From
            <input id="time1" type="text"></input>
          </label>
          <br>
          <label>To
            <input id="time2" type="text"></input>
          </label>
        </label>
      </div>
      <div class="large-4 columns">
        <label>Campus
          <form id="campus">
            <input value="west" type="checkbox" name="campus" id="west"><label for="west">West</label>
            </input>
            <input value="east" type="checkbox" name="campus" id="east"><label for="east">East</label>
            </input>
            <input value="central" type="checkbox" name="campus" id="central"><label for="central">Central</label>
            </input>
          </form>
        </label>
        <a id="clear">Clear</a>
      </div>
    <!-- <div class="row"> -->
      <div class="large-12 columns">
        <br>
        <button id="update_map">Show crimes</button>
      </div>
    </div>
    <br>
    <!-- </div> -->

    <div class="row" align="center" id="gmap" style="width: 600px; height: 400px;">
    </div>
    <div id="controls"></div>

    <br>    <br>    <br>    <br>    <br>\

  </body>

  <link rel="stylesheet" href="pqselect.dev.css" />
  <script src = "pqselect.dev.js"></script>


  <script>
    $('#datepicker').datepicker();
  </script>

  <script>
    $('#time1').timepicker();
    </script>

    <script>
      $('#time2').timepicker();
      </script>

  <script>
  $('#multi-select')
.dropdown()
;
  </script>

  <script>
    $('#multi-select').dropdown();
    $('#multi-select2').dropdown();
  </script>

  <script>
  $('document').ready(function () {

    //load and initialize map
    var map;
    $(function() {
        map = new Maplace({
      locations: [{
         lat: 36.0011,
         lon: -78.9391,
         zoom: 14
     }],
    controls_type: 'list',
    controls_title: 'Choose a location:'
        }).Load();
    });



    //action taken when "show crimes" button pressed
    $("#update_map").click(function() {

      //TODO: multi selects don't work now
      var building = [];
      $('#buildings input:checked').each(function() {
        building.push($(this).attr('value'));
      });
      var crime = [];
      $('#crimes input:checked').each(function() {
        crime.push($(this).attr('value'));
      });
      console.log(building);
      console.log(crime);
      var date = document.getElementById("date").value;
      var time1 = document.getElementById("time1").value;
      var time2 = document.getElementById("time2").value;
      var campus = [];
      $('#campus input:checked').each(function() {
        campus.push($(this).attr('value'));
      });
      var header = '?building=' + JSON.stringify(building) + '&crime=' + JSON.stringify(crime) + '&date=' + date + '&time1= ' + time1 + '&time2=' + time2 + '&campus=' + JSON.stringify(campus);
      //Make ajax call here
      $.ajax({
        url: "./query" + header,
        type: "GET"
      }).done(function(data){
          if(data.error){
            console.log(data.error);
          } else{
            // console.log(map);
            //assume array of info for crimes is returned as data here
            while(map.markers.length > 0){
              map.RemoveLocations(0, true);
            }

            //loop through crimes list and add a marker for each
            for(i=0; i<data.length; i++){
              var temp = data[i];
              var stuff = temp.crime + ", " + temp.loc.building + ", " + temp.loc.campus + " campus";

              map.AddLocations([{lat: temp.lat,
                lon: temp.lon, title: stuff, location: temp.loc, zoom: 18,
                  html: '<p>' + stuff + '</p>',}], i, true);
            }

            //TODO: make the map properly scaled after adding markers
            map.Load();
          }
        });
    });




    //action taken to clear campus specification
    $("#clear").click(function() {
      document.getElementById("west").checked=false;
      document.getElementById("east").checked=false;
      document.getElementById("central").checked=false;
    });




  });
  </script>

  <script src="//maps.google.com/maps/api/js?sensor=false&amp;libraries=geometry&amp;v=3.7"></script>
  <script src="maplace-0.1.3.js"></script>
  </head>

  </html>
